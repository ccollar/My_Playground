name: Update Issue Form with Options

on:
   push:
    paths:
      - '.github/ISSUE_TEMPLATE/authorization.yml'

jobs:
  update-issue-form:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install yq
        run: sudo apt-get install -y yq

      - name: Read options from YAML
        id: read_options
        run: |
          names=$(yq e '.[] | .Name' .github/ISSUE_TEMPLATE/authorization.yml)
          echo "::set-output name=names::${names}"

      - name: Update issue form
        run: |
          yq e '.body[0].attributes.options = env(names)' -i .github/ISSUE_TEMPLATE/test_form.yml

      - name: Commit changes
        run: |
          git config --global user.name 'github-actions'
          git config --global user.email 'github-actions@github.com'
          git add .github/ISSUE_TEMPLATE/bug_report.yml
          git commit -m 'Update issue form options'
          git push
